<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />

    <title>Storage Smart Contract</title>
  </head>
  <body>
    <div class="container my-5">
      <h1>Storage Smart Contract</h1>
      <div class="connect my-5">
        <button
          onclick="enableEthereum()"
          type="button"
          class="btn btn-success"
        >
          Enable Ethereum
        </button>

        <button
          onclick="retrieveAccounts()"
          type="button"
          class="btn btn-success"
        >
          Get accounts
        </button>

        <h4>Success!</h4>
        <p>The following accounts have been connected with metmask</p>
        <ul id="acc0"></ul>
      </div>

      <div class="row g-3">
        <div class="col-auto">
          <label class="">Enter Number to store</label>
          <input type="text" readonly class="form-control-plaintext" />
        </div>
        <div class="col-auto">
          <label class="visually-hidden">Password</label>
          <input
            class="form-control"
            id="storeinpt"
            placeholder="your favorite number"
          />
        </div>
        <div class="col-auto">
          <button onclick="setVal()" class="btn btn-primary mb-3">
            Store value
          </button>
        </div>
      </div>

      <button onclick="getVal()" type="button" class="btn btn-success">
        Get value
      </button>

      <p id="current-val">30</p>
    </div>

    <script>
      const ABI = [
        {
          inputs: [],
          name: "retrieve",
          outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [{ internalType: "uint256", name: "num", type: "uint256" }],
          name: "store",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
      ];
      const contractAddress = "0x2de0cFA5B60Db388b96a3a1F62058bcEC5A87151";

      let accounts = [];

      async function enableEthereum() {
        ethereum.request({ method: "eth_requestAccounts" });
      }
      async function retrieveAccounts() {
        accounts = await web3.eth.getAccounts();
        document.getElementById("acc0").innerText = accounts[0];
        console.log(accounts);
      }

      const web3 = new Web3(ethereum);
      const contract = new web3.eth.Contract(ABI, contractAddress);

      async function setVal() {
        let val = document.getElementById("storeinpt").innerText;
        val = Number(val);
        const tx = await contract.methods.store(20).send({ from: accounts[0] });
        console.log(tx);
        return tx;
      }

      async function getVal() {
        const number = await contract.methods.retrieve().call();
        const currentValue = document.getElementById("current-val");
        currentValue.innerText = number;
      }
    </script>
  </body>
</html>
